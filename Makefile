##
# ft_irc
#
# @make
# @version 0.1.3
#
default: all
#==============================================================================#
#--------------------------------- SHELL --------------------------------------#
#==============================================================================#
SHELL			:= /bin/sh
#==============================================================================#
#------------------------------ DIRECTORIES -----------------------------------#
#==============================================================================#
SRCS_DIR		 = src/
OBJS_DIR		 = obj/
#==============================================================================#
#--------------------------------- FILES --------------------------------------#
#==============================================================================#

SRCS_NAME		  = ogircd
SRCS_NAME		  += c_chanmgmt
SRCS_NAME		  += c_channels
SRCS_NAME		  += c_join
SRCS_NAME		  += c_messages
SRCS_NAME		  += c_modes
SRCS_NAME		  += c_servmanagement
SRCS_NAME		  += u_parsing
SRCS_NAME		  += u_recdata
SRCS_NAME		  += u_regcmds
SRCS_NAME		  += u_replies
SRCS_NAME		  += u_utils
SRCS_NAME		  += Server
#------------------------------------------------------------------------------#
CLIENTSRC		 = client/tcp_chat_client
#------------------------------------------------------------------------------#
SRCS			 = $(addprefix ${SRCS_DIR}, $(addsuffix .cpp, ${SRCS_NAME}))
#------------------------------------------------------------------------------#
#------------------------------------------------------------------------------#
OBJS			 = $(patsubst ${SRCS_DIR}%.cpp,${OBJS_DIR}%.o,${SRCS})
#------------------------------------------------------------------------------#
NAME			 = ogircd
#------------------------------------------------------------------------------#
#==============================================================================#
#-------------------------------- COMPILER ------------------------------------#
#==============================================================================#
CC				 = clang++
CFLAGS			+= -Wall
CFLAGS			+= -Wextra
CFLAGS			+= -Werror
CFLAGS			+= -pedantic
CFLAGS			+= -std=c++98
CFLAGS			+= -march=native -O2 -pipe
#==============================================================================#
#--------------------------------- UNIX ---------------------------------------#
#==============================================================================#
RM				= rm -rf
MKDIR			= mkdir -p
#==============================================================================#
#--------------------------------- RULES --------------------------------------#
#==============================================================================#
${OBJS_DIR}%.o:	${SRCS_DIR}%.cpp
	${CC} -c ${CFLAGS} ${CDEFS} -o $@ $< ${LDFLAGS}
#------------------------------------------------------------------------------#
${OBJS_DIR}:
	${MKDIR} ${OBJS_DIR}
#------------------------------------------------------------------------------#
$(NAME): ${OBJS}
	${CC} ${CFLAGS} ${CDEFS} -o ${NAME} ${OBJS} ${LDFLAGS}
#------------------------------------------------------------------------------#
all: ${OBJS_DIR} ${NAME}
#------------------------------------------------------------------------------#
debug: CFLAGS += -D DEBUG_IRC=1
debug: all
#------------------------------------------------------------------------------#
debug_asan: CFLAGS += -D DEBUG_IRC=1
debug_asan: asan
#------------------------------------------------------------------------------#
asan: CFLAGS += -g3
asan: CFLAGS += -fsanitize=address
asan: LFTRULE = asan
asan: all
#------------------------------------------------------------------------------#
msan: CFLAGS += -g3
msan: CFLAGS += -fsanitize=memory
msan: CFLAGS += -fsanitize-memory-track-origins
msan: CFLAGS += -fno-common
msan: CFLAGS += -fno-omit-frame-pointer
msan: LFTRULE = msan
msan: all
#------------------------------------------------------------------------------#

tags:
	ctags -e -R .
#------------------------------------------------------------------------------#
clean:
	${RM} ${OBJS_DIR} vgcore*
#------------------------------------------------------------------------------#
fclean: clean
	${RM} ${NAME} ${NAME}.core ${NAME}.dSYM/ valgrind.log ctest
#------------------------------------------------------------------------------#
re: fclean all
#------------------------------------------------------------------------------#
ctest: ${CLIENTSRC}.c
	clang client/tcp_chat_client.c -o ctest
#------------------------------------------------------------------------------#
.PHONY:	all clean clean fclean re debug asan

# end
